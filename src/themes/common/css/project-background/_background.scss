/**
 * Copyright (c) Enalean, 2020 - Present. All Rights Reserved.
 *
 * This file is a part of Tuleap.
 *
 * Tuleap is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * Tuleap is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Tuleap. If not, see <http://www.gnu.org/licenses/>.
 */

@use 'sass:map';

$project-background-images-path: '../../images/project-background/' !default;

$definitions: (
    beach:
    (
        // Photo by Joschko Hammermann
        // https://unsplash.com/@hmmrmnn?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText
        image: url(#{$project-background-images-path}/beach.webp) no-repeat,
        color: #765730,
        size: 100%
    ),
    bridge:
    (
        // Photo by David Emrich
        // https://unsplash.com/@davidemrich?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText
        image: url(#{$project-background-images-path}/bridge.webp) no-repeat,
        color: #757f16,
        size: 100%
    )
);

@function get-image($background) {
    $def: map-get($definitions, $background);
    @return map-get($def, 'image');
}

@function get-color($background) {
    $def: map-get($definitions, $background);
    @return map-get($def, 'color');
}

@function get-size($background) {
    $def: map-get($definitions, $background);
    @return map-get($def, 'size');
}

@function opacifier-color($sidebar-background) {
    @return transparentize($sidebar-background, .7);
}

@mixin css-custom-properties($background) {
    --project-background-image: #{get-image($background)};
    --project-background-prominent-color: #{get-color($background)};
    --project-background-size: #{get-size($background)};
}

@mixin apply-background(
    $element,
    $sidebar-background,
    $sidebar-expanded-width,
    $sidebar-collapsed-width
) {
    $motd-minimum-height: 58px;
    $project-banner-minimum-height: 56px;
    $opacifier-color: opacifier-color($sidebar-background);

    .project-with-background #{$element} {
        background:
            linear-gradient($opacifier-color, $opacifier-color),
            var(--project-background-image),
            linear-gradient(var(--project-background-prominent-color), var(--project-background-prominent-color));
        background-attachment: fixed;
        background-position: $sidebar-expanded-width 0;
        background-size: var(--project-background-size);
    }

    .motd ~ #main-container .project-with-background #{$element} {
        background-position: $sidebar-expanded-width $motd-minimum-height;
    }

    &.sidebar-collapsed {
        .project-with-background #{$element} {
            background-position: $sidebar-collapsed-width 0;
        }

        .motd ~ #main-container .project-with-background #{$element} {
            background-position: $sidebar-collapsed-width $motd-minimum-height;
        }
    }

    &.has-visible-project-banner {
        .project-with-background #{$element} {
            background-position: $sidebar-expanded-width $project-banner-minimum-height;
        }

        .motd ~ #main-container .project-with-background #{$element} {
            background-position: $sidebar-expanded-width ($project-banner-minimum-height + $motd-minimum-height);
        }

        &.sidebar-collapsed {
            .project-with-background #{$element} {
                background-position: $sidebar-collapsed-width $project-banner-minimum-height;
            }

            .motd ~ #main-container .project-with-background #{$element} {
                background-position: $sidebar-collapsed-width ($project-banner-minimum-height + $motd-minimum-height);
            }
        }
    }
}
