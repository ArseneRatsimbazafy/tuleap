<div class="tlp-alert-danger" ng-if="execution.error">{{ execution.error }}</div>

<div class="tuleap-modal-loading" ng-if="artifact_links_graph_modal_loading.is_loading || edit_artifact_modal_loading.loading"></div>

<section id="test" class="tlp-pane current-test" ng-class="execution.status | dasherize">
    <div class="tlp-pane-container">
        <section class="tlp-pane-header current-test-header">
            <i class="fa fa-check current-test-status" ng-if="execution.status === 'passed'"></i>
            <i class="fa fa-times current-test-status" ng-if="execution.status === 'failed'"></i>
            <i class="fa fa-exclamation current-test-status" ng-if="execution.status === 'blocked'"></i>
            <div class="current-test-header-title-container">
                <h1 class="current-test-header-title">
                    {{ execution.definition.summary }}
                </h1>
                <div class="current-test-header-who">
                    <span ng-if="execution.previous_result.submitted_on">
                        {{ execution.previous_result.submitted_on | amCalendar }}
                    </span>
                    <span ng-if="execution.previous_result.submitted_by.real_name">
                        <span translate>by</span> {{ execution.previous_result.submitted_by.real_name }}
                    </span>
                </div>
                <div class="current-test-header-comment" ng-if="execution.previous_result.result">
                    <ng-bind-html ng-bind-html="sanitizeHtml(execution.previous_result.result)"></ng-bind-html>
                </div>
            </div>

            <div class="current-test-header-actions">
                <a href="/plugins/tracker/?aid={{ execution.definition.id }}" class="current-test-header-action">
                    <i class="fa fa-fw fa-pencil"
                       ng-click="showEditArtifactModal($event, execution.definition)"
                       title="{{ 'Edit this test' | translate }}"></i>
                </a>
                <img class="current-test-header-action"
                     src="scripts/angular/bin/assets/artifact-link-graph.svg"
                     type="image/svg+xml"
                     alt="Graph"
                     ng-click="showArtifactLinksGraphModal(execution)"
                     title="{{ 'Show dependencies graph for this test' | translate }}"
                />
            </div>
        </section>

        <section class="tlp-pane-section current-test-content">
            <h2>Steps</h2>
            <div ng-bind-html="sanitizeHtml(execution.definition.description)"></div>
        </section>

        <section class="tlp-pane-section current-test-footer">
            <div class="current-test-comment-counter">
                <textarea class="tlp-textarea current-test-comment"
                          placeholder="{{ 'Comment...' | translate }}"
                          ng-model="execution.results">
                </textarea>
                <timer class="tlp-form-element tlp-form-element-append current-test-counter" ng-model="timer.execution_time"></timer>
            </div>
            <div class="current-test-results">
                <button id="test-result-passed" type="button" class="current-test-result tlp-button-large tlp-button-success" title="{{ 'Passed' | translate }}" ng-click="pass(execution)" ng-disabled="execution.saving">
                    <i class="fa fa-fw fa-check-circle"></i>
                </button>
                <button id="test-result-failed" type="button" class="current-test-result tlp-button-large tlp-button-danger" title="{{ 'Failed' | translate }}" ng-click="fail(execution)" ng-disabled="execution.saving">
                    <i class="fa fa-fw fa-times-circle"></i>
                </button>
                <button id="test-result-blocked" type="button" class="current-test-result tlp-button-large tlp-button-info" title="{{ 'Blocked' | translate }}" ng-click="block(execution)" ng-disabled="execution.saving">
                    <i class="fa fa-fw fa-exclamation-circle"></i>
                </button>
                <button id="test-result-notrun" type="button" class="current-test-result tlp-button-large tlp-button-secondary" title="{{ 'Not run' | translate }}" ng-click="notrun(execution)" ng-disabled="execution.saving">
                    <i class="fa fa-fw fa-question-circle"></i>
                </button>
            </div>
        </section>
    </div>
</div>
