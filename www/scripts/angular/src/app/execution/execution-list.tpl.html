<socket-disconnect></socket-disconnect>
<div id="execution-utils">
    <div id="execution-utils-information">
        <div id="execution-utils-campaign">
            <h1>{{ campaign.label }}</h1>
            <div class="btn-group execution-utils-environment">
                <button
                        type="button"
                        class="btn btn-small dropdown-toggle"
                        data-toggle="dropdown"
                        aria-haspopup="true"
                        aria-expanded="false"
                        onclick="this.blur();"
                        translate
                >
                    Add a test <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                    <li ng-repeat="environment in environments"><a ng-click="selectEnvironmentCreation([environment])">{{environment}}</a></li>
                    <li><a ng-click="selectEnvironmentCreation(environments)" translate>For all</a></li>
                </ul>
            </div>
        </div>
        <div id="execution-utils-avatars">
        <span class="execution-avatar" ng-repeat="presence in presences_on_campaign | orderBy:'-score' | limitTo:6">
            <img data-toggle="tooltip"
                 title="{{ presence.real_name }}"
                 ng-src="{{ presence.avatar_url }}"
                 onerror="this.src='scripts/angular/bin/assets/avatar_default.png'"
                 alt="avatar">
            <span animate-change="presence.score" change-class="ng-animate" class="presence-score" ng-if="presence.score >= 0">{{ presence.score }}</span>
            <span animate-change="presence.score" change-class="ng-animate" class="presence-score" ng-if="presence.score < 0">0</span>
        </span>
            <span id="more-avatars" ng-if="presences_on_campaign.length > 3" ng-click="showPresencesModal()"><i class="icon-ellipsis-horizontal"></i></span>
        </div>
    </div>
    <div id="execution-utils-progress-bar">
        <div class="sense-of-progress-passed" ng-if="campaign.nb_of_passed" style="width: {{ campaign.nb_of_passed * 100 / campaign.total }}%">
            <span>{{ campaign.nb_of_passed }}</span>
        </div>
        <div class="sense-of-progress-failed" ng-if="campaign.nb_of_failed" style="width: {{ campaign.nb_of_failed * 100 / campaign.total }}%">
            <span>{{ campaign.nb_of_failed }}</span>
        </div>
        <div class="sense-of-progress-blocked" ng-if="campaign.nb_of_blocked" style="width: {{ campaign.nb_of_blocked * 100 / campaign.total }}%">
            <span>{{ campaign.nb_of_blocked }}</span>
        </div>
        <div class="sense-of-progress-notrun" ng-if="campaign.nb_of_notrun" style="width: {{ campaign.nb_of_notrun * 100 / campaign.total }}%">
            <span>{{ campaign.nb_of_notrun }}</span>
        </div>
    </div>
</div>

<div id="executions">
    <div id="executions-pane">
        <div id="execution-filter">
            <form class="form-inline">
                <div id="filter">
                    <div>
                        <input type="text" class="filter" placeholder="{{ 'Filter...' | translate }}" ng-model="search">
                    </div>
                    <div>
                        <select ng-model="selected_environment" ng-options="environment for environment in environments">
                            <option value="" translate>All environments</option>
                        </select>
                    </div>
                    <div class="btn-group">
                        <label class="btn" ng-model="status.passed"  title="{{ 'Passed' | translate }}" btn-checkbox><img src="scripts/angular/bin/assets/status-passed-color.png" alt="{{ 'Passed' | translate }}"></label>
                        <label class="btn" ng-model="status.failed"  title="{{ 'Failed' | translate }}" btn-checkbox><img src="scripts/angular/bin/assets/status-failed-color.png" alt="{{ 'Failed' | translate }}"></label>
                        <label class="btn" ng-model="status.blocked" title="{{ 'Blocked' | translate }}" btn-checkbox><img src="scripts/angular/bin/assets/status-blocked-color.png" alt="{{ 'Blocked' | translate }}"></label>
                        <label class="btn" ng-model="status.notrun"  title="{{ 'Not run' | translate }}" btn-checkbox><img src="scripts/angular/bin/assets/status-notrun-color.png" alt="{{ 'Not run' | translate }}"></label>
                    </div>
                </div>
            </form>
        </div>

        <div id="execution-list">
            <div ng-repeat="category in categories" ng-if="canCategoryBeDisplayed(category)">
                <div class="category">{{ category.label }}</div>
                <a class="execution-item {{ execution.status | dasherize }}"
                   ng-repeat="execution in category.executions | ExecutionListFilter:search:status:selected_environment track by $index"
                   ui-sref=".detail({ execid: execution.id, defid: execution.definition.id })"
                   ng-class="{active: checkActiveClassOnExecution(execution)}">
                   <span class="execution-item-content" ng-click="viewTestExecution(execution)">
                       <span class="execution-item-content-title">
                           <span ng-if="execution.viewed_by" ng-repeat="user in execution.viewed_by">
                              <img class="avatar ng-enter"
                                   data-toggle="tooltip"
                                   title="{{ user.real_name }}"
                                   ng-src="{{ user.avatar_url }}"
                                   onerror="this.src='scripts/angular/bin/assets/avatar_default.png'"
                                   alt="avatar">
                          </span>
                           <span class="execution-item-content-id">#{{ execution.definition.id }}</span>{{ execution.definition.summary}}
                       </span>
                       <span class="execution-item-content-environment"> {{ execution.environment }}</span>
                   </span>
                </a>
            </div>

            <img src="scripts/angular/bin/assets/loader.gif" ng-if="loading()" class="loader">
        </div>
    </div>

    <div ui-view>
        <div id="no-current-execution">
            <i class="icon-hand-left"></i> {{ 'Please select a test' | translate }}
        </div>
    </div>
</div>
