<socket-disconnect></socket-disconnect>
<div class="tlp-framed test-campaign">
    <div class="test-campaign-header">
        <h1 class="test-campaign-header-title">{{ campaign.label }}</h1>
        <button type="button"
                class="tlp-button-primary edit-campaign-button"
                aria-haspopup="true"
                aria-expanded="false"
                onclick="this.blur();"
                ng-click="openEditCampaignModal()">
            <i class="fa fa-pencil tlp-button-icon"></i> {{ 'Edit' | translate }}
        </button>
        <div class="test-campaign-header-spacer"></div>
        <div class="test-campaign-tester"
             ng-if="isRealtimeEnabled()"
             ng-repeat="presence in presences_on_campaign | orderBy:'-score' | limitTo:6"
        >
            <div class="tlp-avatar tlp-tooltip tlp-tooltip-top" data-tlp-tooltip="{{ presence.real_name }}">
                <img title="{{ presence.real_name }}"
                     ng-src="{{ presence.avatar_url }}"
                     onerror="this.src='scripts/angular/bin/assets/avatar_default.png'"
                     alt="avatar">
            </div>
            <span class="tlp-badge-primary">{{ positiveScore(presence.score) }}</span>
        </div>
        <i class="fa fa-trophy test-campaign-header-trophy"
           ng-if="isRealtimeEnabled()"
           ng-click="showPresencesModal()"></i>
    </div>

    <div class="test-campaign-current-progression-container">
        <div class="test-campaign-current-progression">
            <div class="tests-passed" ng-if="campaign.nb_of_passed" style="width: {{ campaign.nb_of_passed * 100 / campaign.total }}%">
                {{ campaign.nb_of_passed }}
            </div>
            <div class="tests-failed" ng-if="campaign.nb_of_failed" style="width: {{ campaign.nb_of_failed * 100 / campaign.total }}%">
                {{ campaign.nb_of_failed }}
            </div>
            <div class="tests-blocked" ng-if="campaign.nb_of_blocked" style="width: {{ campaign.nb_of_blocked * 100 / campaign.total }}%">
                {{ campaign.nb_of_blocked }}
            </div>
            <div class="tests-notrun" ng-if="campaign.nb_of_notrun" style="width: {{ campaign.nb_of_notrun * 100 / campaign.total }}%">
                {{ campaign.nb_of_notrun }}
            </div>
        </div>
    </div>

    <div class="test-campaign-tests">
        <section class="tlp-pane tests-pane">
            <div class="tlp-pane-container">
                <section class="tlp-pane-section tests-list-filters">
                    <input type="search"
                           class="tlp-search tlp-search-small tests-list-filter-search"
                           placeholder="{{ 'Id, summary, categoryâ€¦' | translate }}"
                           ng-model="search">

                    <div class="tlp-button-bar">
                        <div class="tlp-button-bar-item">
                            <input type="checkbox" id="status-filter-passed" class="tlp-button-bar-checkbox">
                            <label for="status-filter-passed"
                                   class="tlp-button-small tlp-button-secondary"
                                   ng-click="toggleStatus('passed')"
                                   title="{{ 'Passed' | translate }}">
                                <i class="fa fa-fw fa-lg fa-check-circle test-status-icon passed"></i>
                            </label>
                        </div>
                        <div class="tlp-button-bar-item">
                            <input type="checkbox" id="status-filter-failed" class="tlp-button-bar-checkbox">
                            <label for="status-filter-failed"
                                   class="tlp-button-small tlp-button-secondary"
                                   ng-click="toggleStatus('failed')"
                                   title="{{ 'Failed' | translate }}">
                                <i class="fa fa-fw fa-lg fa-times-circle test-status-icon failed"></i>
                            </label>
                        </div>
                        <div class="tlp-button-bar-item">
                            <input type="checkbox" id="status-filter-blocked" class="tlp-button-bar-checkbox">
                            <label for="status-filter-blocked"
                                   class="tlp-button-small tlp-button-secondary"
                                   ng-click="toggleStatus('blocked')"
                                   title="{{ 'Blocked' | translate }}">
                                <i class="fa fa-fw fa-lg fa-exclamation-circle test-status-icon blocked"></i>
                            </label>
                        </div>
                        <div class="tlp-button-bar-item">
                            <input type="checkbox" id="status-filter-notrun" class="tlp-button-bar-checkbox">
                            <label for="status-filter-notrun"
                                   class="tlp-button-small tlp-button-secondary"
                                   ng-click="toggleStatus('notrun')"
                                   title="{{ 'Not run' | translate }}">
                                <i class="fa fa-fw fa-lg fa-question-circle test-status-icon notrun"></i>
                            </label>
                        </div>
                    </div>
                </section>

                <section class="tlp-pane-section tests-list-section">
                    <ul class="tests-list">
                        <li class="tests-list-category"
                            ng-repeat-start="category in categories"
                            ng-if="canCategoryBeDisplayed(category)">
                            {{ category.label }}
                        </li>
                        <li class="tests-list-test {{ execution.status | dasherize }}"
                            ng-repeat-end=""
                            ng-repeat="execution in category.executions
                                | toArray:false
                                | ExecutionListFilter:search:status
                                | orderBy:'definition.id'
                                | unique:'definition.id'
                                track by execution.definition.id"
                            ui-sref=".detail({ execid: execution.id, defid: execution.definition.id })"
                            ng-click="viewTestExecution(execution)"
                            ng-class="{active: checkActiveClassOnExecution(execution)}">
                            <div class="tlp-avatar-small tlp-tooltip tlp-tooltip-top"
                                 data-tlp-tooltip="{{ presence.real_name }}"
                                 ng-if="execution.viewed_by"
                                 ng-repeat="user in execution.viewed_by">
                                <img title="{{ user.real_name }}"
                                     ng-src="{{ user.avatar_url }}"
                                     onerror="this.src='scripts/angular/bin/assets/avatar_default.png'"
                                     alt="avatar">
                            </div>
                            <span class="tests-list-test-title">
                                <span class="tests-list-test-id">
                                    #{{ execution.definition.id }}
                                </span>
                                {{ execution.definition.summary}}
                            </span>
                            <i class="fa fa-check-circle test-status-icon passed"
                               ng-if="execution.status === 'passed'"
                               title="{{ 'Passed' | translate }}"></i>
                            <i class="fa fa-times-circle test-status-icon failed"
                               ng-if="execution.status === 'failed'"
                               title="{{ 'Failed' | translate }}"></i>
                            <i class="fa fa-exclamation-circle test-status-icon blocked"
                               ng-if="execution.status === 'blocked'"
                               title="{{ 'Blocked' | translate }}"></i>
                        </li>
                    </ul>

                    <img src="scripts/angular/bin/assets/loader.gif" ng-if="loading()" class="loader">
                </section>
            </div>
        </section>

        <section class="current-test" ui-view>
            <section class="no-tests-selected">
                <i class="fa fa-hand-o-left no-tests-selected-icon"></i>
                {{ 'Please select a test' | translate }}
            </section>
        </section>
    </div>
</div>

